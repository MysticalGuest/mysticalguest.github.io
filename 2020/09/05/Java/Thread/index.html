<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Java多线程 - Longing(MysteryGuest的博客)</title><meta description="创建线程的主要方式  继承Thread类创建线程类（重点） 实现Runnable接口创建线程类（重点） 实现Callable接口或Future接口创建线程（了解）"><meta property="og:type" content="blog"><meta property="og:title" content="Java多线程"><meta property="og:url" content="https://mysticalguest.github.io/"><meta property="og:site_name" content="Longing(MysteryGuest的博客)"><meta property="og:description" content="创建线程的主要方式  继承Thread类创建线程类（重点） 实现Runnable接口创建线程类（重点） 实现Callable接口或Future接口创建线程（了解）"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/wolf.png"><meta property="article:published_time" content="2020-09-05T15:50:15.714Z"><meta property="article:modified_time" content="2020-09-09T03:15:34.105Z"><meta property="article:author" content="MysticalGuest"><meta property="article:tag" content="Java"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/wolf.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mysticalguest.github.io/2020/09/05/Java/Thread/"},"headline":"MysteryGuest","image":["https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/wolf.png"],"datePublished":"2020-09-05T15:50:15.714Z","dateModified":"2020-09-09T03:15:34.105Z","author":{"@type":"Person","name":"MysticalGuest"},"description":"java,技术分享,后端开发,算法,spring"}</script><link rel="canonical" href="https://mysticalguest.github.io/2020/09/05/Java/Thread/"><link rel="alternative" href="/atom.xml" title="Longing(MysteryGuest的博客)" type="application/atom+xml"><link rel="icon" href="/img/bird.ico"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script src="/js/click.js"></script><script src="/js/anime.min.js"></script><canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas><script src="/js/snow.js"></script><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/mylogo.svg" alt="Longing(MysteryGuest的博客)" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Visit on GitHub" href="https://github.com/MysticalGuest"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/wolf.png" alt="Java多线程"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-09-05T15:50:15.714Z" title="2020-09-05T15:50:15.714Z">2020-09-05</time><span class="level-item"><a class="link-muted" href="/categories/%E5%8E%9F%E7%90%86/">原理</a></span><span class="level-item">1 小时 读完 (大约 7617 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Java多线程</h1><div class="content"><blockquote>
<p>创建线程的<strong>主要</strong>方式</p>
<ol>
<li>继承Thread类创建线程类（重点）</li>
<li>实现Runnable接口创建线程类（重点）</li>
<li>实现Callable接口或Future接口创建线程（了解）</li>
</ol>
</blockquote>
<a id="more"></a>
<h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><p>关于学习Java多线程，其中程序，进程和线程等重要概念及其关系在这里就不多赘述，之前操作系统也详细讲过，我就不再详细扩展，直接进入Java线程的学习吧！</p>
<p>此处分享一下<a href="https://pan.baidu.com/s/1BqJdwPNVusF14r9JhMzwdA">Java1.8帮助文档</a>（中文版），提取码: k26d</p>
<h2 id="2、Thread类"><a href="#2、Thread类" class="headerlink" title="2、Thread类"></a>2、Thread类</h2><h3 id="2-1-Thread类实现Runnable接口"><a href="#2-1-Thread类实现Runnable接口" class="headerlink" title="2.1 Thread类实现Runnable接口"></a>2.1 Thread类实现Runnable接口</h3><p>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* Make sure registerNatives is the first thing &lt;clinit&gt; does. */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">registerNatives</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    registerNatives();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">volatile</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span>            priority;</span><br><span class="line">  <span class="keyword">private</span> Thread         threadQ;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span>           eetop;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Whether or not to single_step this thread. */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span>     single_step;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-创建步骤："><a href="#2-2-创建步骤：" class="headerlink" title="2.2 创建步骤："></a>2.2 创建步骤：</h3><p><strong>将一个类声明为<code>Thread</code>的子类。  这个子类应该重写<code>Thread</code>类的<code>run</code>方法 。 然后可以分配并启动子类的实例</strong></p>
<ul>
<li>自定义线程类继承<strong>Thread类</strong></li>
<li>重写<strong>run()</strong>方法，编写线程执行体</li>
<li>创建线程对象，调用<strong>start()</strong>方法启动线程</li>
</ul>
<h4 id="2-2-1-测试"><a href="#2-2-1-测试" class="headerlink" title="2.2.1 测试"></a>2.2.1 测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// run方法线程体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">      System.out.print(String.format(<span class="string">"%-3d"</span>, i) + <span class="string">"Hello    "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// main方法主线程</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建一个线程对象</span></span><br><span class="line">    Thread1 thread1 = <span class="keyword">new</span> Thread1();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 调用start方法开启线程</span></span><br><span class="line">    thread1.start();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">800</span>; i++) &#123;</span><br><span class="line">      System.err.print(String.format(<span class="string">"%-3d"</span>, i) + <span class="string">"World    "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看控制台输出：</p>
<p><img src="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/thread1.PNG" alt=""></p>
<blockquote>
<p>注意：线程开启不一定立即执行，由CPU调度执行</p>
<p>调用start方法，是线程同时执行，交替执行。如果调用run方法，就是顺序执行。</p>
</blockquote>
<p><img src="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/run_and_start.PNG" alt=""></p>
<h4 id="2-2-2-案例：实现多线程同步下载图片"><a href="#2-2-2-案例：实现多线程同步下载图片" class="headerlink" title="2.2.2 案例：实现多线程同步下载图片"></a>2.2.2 案例：实现多线程同步下载图片</h4><p>APACHE官网下载<a href="https://commons.apache.org/proper/commons-io/download_io.cgi">commons-io</a>，导入项目Library</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">private</span> String url;		<span class="comment">// Picture url</span></span><br><span class="line">  <span class="keyword">private</span> String path;</span><br><span class="line">  <span class="keyword">private</span> String name;	<span class="comment">// Saved file name</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Thread2</span><span class="params">(String url, String path, String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.url = url;</span><br><span class="line">    <span class="keyword">this</span>.path = path;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    WebDownloader webDownloader = <span class="keyword">new</span> WebDownloader();</span><br><span class="line">    webDownloader.downloader(url, path, name);</span><br><span class="line">    System.out.println(<span class="string">"Downloaded the file which name is "</span> + name);</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String path = <span class="string">"src/com/newthread/img/"</span>;</span><br><span class="line">    Thread2 t1 = <span class="keyword">new</span> Thread2(</span><br><span class="line">        <span class="string">"https://wx1.sinaimg.cn/orj360/67e231a6ly1geq8okovekj21hc0u0e42.jpg"</span>,</span><br><span class="line">        path, <span class="string">"tower.jpg"</span>);</span><br><span class="line">    Thread2 t2 = <span class="keyword">new</span> Thread2(</span><br><span class="line">        <span class="string">"https://wx1.sinaimg.cn/orj360/67e231a6ly1geq8oq8jx1j21hc0u0qse.jpg"</span>,</span><br><span class="line">        path, <span class="string">"bike.jpg"</span>);</span><br><span class="line">    Thread2 t3 = <span class="keyword">new</span> Thread2(</span><br><span class="line">        <span class="string">"https://wx1.sinaimg.cn/orj360/67e231a6ly1geq8on2u4gj21hc0u0ngj.jpg"</span>,</span><br><span class="line">        path, <span class="string">"bridge.jpg"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// simultaneous execution</span></span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t3.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// downloader</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebDownloader</span></span>&#123;</span><br><span class="line">  <span class="comment">// download function</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">downloader</span><span class="params">(String url, String path,String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url), <span class="keyword">new</span> File(path + name));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">      System.err.println(<span class="string">"IO Exception...downloader function has a problem!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/webdownloader.PNG" alt=""></p>
<h2 id="3、Runnable接口"><a href="#3、Runnable接口" class="headerlink" title="3、Runnable接口"></a>3、Runnable接口</h2><h3 id="3-1-Runnable接口"><a href="#3-1-Runnable接口" class="headerlink" title="3.1 Runnable接口"></a>3.1 Runnable接口</h3><p>声明实现类<code>Runnable</code>接口。 那个类然后实现了<code>run</code>方法。  然后可以分配类的实例，在<strong>创建<code>Thread</code>时作为参数传递</strong>，并启动。</p>
<p>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="comment">/* Make sure registerNatives is the first thing &lt;clinit&gt; does. */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">registerNatives</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    registerNatives();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Thread</span><span class="params">(Runnable target)</span> </span>&#123;</span><br><span class="line">    init(<span class="keyword">null</span>, target, <span class="string">"Thread-"</span> + nextThreadNum(), <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实现Runnable接口创建的线程，不能通过run或start方法来启动。在Thread类中有一个构造器，这个构造器接收一个Runnable接口的实现类对象，构造Thread线程类对象，然后使用这个线程类对象调用start方法启动我们的线程。</p>
</blockquote>
<h3 id="3-2-创建步骤"><a href="#3-2-创建步骤" class="headerlink" title="3.2 创建步骤"></a>3.2 创建步骤</h3><ul>
<li>自定义线程类实现<strong>Runnable接口</strong></li>
<li>实现<strong>run()</strong>方法，编写线程执行体</li>
<li>创建线程对象，调用<strong>start()</strong>方法启动线程</li>
</ul>
<p>推荐使用Runnable对象，因为Java单继承的局限性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread3</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// run方法线程体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">      System.out.print(String.format(<span class="string">"%-3d"</span>, i) + <span class="string">"Hello    "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// main方法主线程</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建Runnable接口的实现类对象</span></span><br><span class="line">    Thread3 thread3 = <span class="keyword">new</span> Thread3();</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    Thread thread = new Thread(thread3);</span></span><br><span class="line"><span class="comment">//    thread.start();</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> Thread(thread3).start();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">800</span>; i++) &#123;</span><br><span class="line">      System.err.print(String.format(<span class="string">"%-3d"</span>, i) + <span class="string">"World    "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-对比"><a href="#3-3-对比" class="headerlink" title="3.3 对比"></a>3.3 对比</h3><ul>
<li>继承Thread类<ul>
<li>子类继承Thread类具有多线程能力</li>
<li>启动线程：子类对象.start()</li>
<li>不建议使用：避免OOP单继承局限</li>
</ul>
</li>
<li>实现Runnable接口<ul>
<li>子类实现Runnable接口具有多线程能力</li>
<li>启动线程：传入目标对象+Thread对象.start()</li>
<li>推荐使用：避免单继承局限性，灵活方便，方便同一对象被多个线程使用</li>
</ul>
</li>
</ul>
<h2 id="4、Callable接口（了解即可）"><a href="#4、Callable接口（了解即可）" class="headerlink" title="4、Callable接口（了解即可）"></a>4、Callable接口（了解即可）</h2><h3 id="4-1-源码："><a href="#4-1-源码：" class="headerlink" title="4.1 源码："></a>4.1 源码：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Computes a result, or throws an exception if unable to do so.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> computed result</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception if unable to compute a result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">  <span class="function">V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>从源码可以看出，Callable接口中的call()方法是有返回值的，是一个泛型，和Future、FutureTask配合可以用来获取异步执行的结果。</p>
<p>这其实是很有用的一个特性，因为多线程相比单线程更难、更复杂的一个重要原因就是因为多线程充满着未知性，某条线程是否执行了？某条线程执行了多久？某条线程执行的时候我们期望的数据是否已经赋值完毕？无法得知，我们能做的只是等待这条多线程的任务执行完毕而已。而Callable+Future/FutureTask却可以获取多线程运行的结果，可以在等待时间太长没获取到需要的数据的情况下取消该线程的任务。</p>
</blockquote>
<h3 id="4-2-创建步骤"><a href="#4-2-创建步骤" class="headerlink" title="4.2 创建步骤"></a>4.2 创建步骤</h3><ul>
<li><p>实现Callable接口，需要返回值类型</p>
</li>
<li><p>重写call方法，需要抛出异常</p>
</li>
<li><p>创建目标对象</p>
</li>
<li><p>创建执行服务：<code>ExecutorService ser = Executors.newFixedThreadPool(1);</code></p>
</li>
<li><p>提交执行：<code>Future&lt; Boolean&gt; result1 = ser.submit(1);</code></p>
</li>
<li><p>获取结果：<code>boolean r1= result1.get();</code></p>
</li>
<li><p>关闭服务：<code>ser.shutdownNow();</code></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Callable1</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Boolean</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">      System.out.println(String.format(<span class="string">"%-3d"</span>, i) +</span><br><span class="line">            Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line"></span><br><span class="line">    Callable1 callable1 = <span class="keyword">new</span> Callable1();</span><br><span class="line">    Callable1 callable2 = <span class="keyword">new</span> Callable1();</span><br><span class="line">    Callable1 callable3 = <span class="keyword">new</span> Callable1();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建执行服务</span></span><br><span class="line">    ExecutorService ser = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提交执行</span></span><br><span class="line">    Future&lt;Boolean&gt; result1 = ser.submit(callable1);</span><br><span class="line">    Future&lt;Boolean&gt; result2 = ser.submit(callable2);</span><br><span class="line">    Future&lt;Boolean&gt; result3 = ser.submit(callable3);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取结果</span></span><br><span class="line">    <span class="keyword">boolean</span> r1= result1.get();</span><br><span class="line">    <span class="keyword">boolean</span> r2= result2.get();</span><br><span class="line">    <span class="keyword">boolean</span> r3= result3.get();</span><br><span class="line">    System.out.println(r1 + <span class="string">" "</span>+ r2 + <span class="string">" "</span> + r3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭服务</span></span><br><span class="line">    ser.shutdownNow();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5、静态代理模式"><a href="#5、静态代理模式" class="headerlink" title="5、静态代理模式"></a>5、静态代理模式</h2><h3 id="5-1-内容"><a href="#5-1-内容" class="headerlink" title="5.1 内容"></a>5.1 内容</h3><p>真实角色，代理角色；真实角色和代理角色要实现同一个接口，代理角色要持有真实角色的<strong>引用</strong>。</p>
<blockquote>
<p>在Java中线程的设计使用了静态代理设计模式，其中自定义线程类实现Runable接口，Thread类也实现了Runalbe接口，在创建子线程的时候，传入了自定义线程类的引用，再通过调用start()方法，调用自定义线程对象的run()方法。实现了线程的并发执行。</p>
</blockquote>
<p>Thread对象调用线程的start()方法，在内部调用了真实角色的run()方法。</p>
<h3 id="5-2-设计"><a href="#5-2-设计" class="headerlink" title="5.2 设计"></a>5.2 设计</h3><p>代码结构由三部分组成</p>
<ul>
<li><p>接口：主题</p>
</li>
<li><p>代理类</p>
</li>
<li><p>被代理类</p>
</li>
</ul>
<blockquote>
<p>实现方式：代理类和被代理类要实现同一个主题接口，而且代理类中要有一个被代理类的属性（target），这样才能把核心业务逻辑交还给被代理类完成；而一些与核心业务逻辑无关的逻辑，并且需求是多变的，那么这些逻辑就可以交给代理类来完成。</p>
<p>代理对象可以做很多真实对象做不了的事情，真实对象专注做自己的事情</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticProxy</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringPioneer springPioneer = <span class="keyword">new</span> SpringPioneer(<span class="keyword">new</span> Programmer());</span><br><span class="line">    springPioneer.Deploy();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">SpringBootFrame</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 接口主题：框架整合部署</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Deploy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实角色，程序员</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Programmer</span> <span class="keyword">implements</span> <span class="title">SpringBootFrame</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Deploy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"Programmer SpringBoot deployed successfully!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理角色，SpringBoot的作者，帮我们简化开发</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringPioneer</span> <span class="keyword">implements</span> <span class="title">SpringBootFrame</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 代理谁--&gt;真实目标角色</span></span><br><span class="line">  <span class="keyword">private</span> SpringBootFrame target;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SpringPioneer</span><span class="params">(SpringBootFrame target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.target = target;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Deploy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    before();</span><br><span class="line">    <span class="keyword">this</span>.target.Deploy();	<span class="comment">// 这就是真实对象</span></span><br><span class="line">    after();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"研发出这个SpringBoot框架，并开源。"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"不断推出新的特性。"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、Lambda表达式"><a href="#6、Lambda表达式" class="headerlink" title="6、Lambda表达式"></a>6、Lambda表达式</h2><p>函数式编程的概念</p>
<h3 id="6-1-为什么要使用lambda表达式？"><a href="#6-1-为什么要使用lambda表达式？" class="headerlink" title="6.1 为什么要使用lambda表达式？"></a>6.1 为什么要使用lambda表达式？</h3><p>避免匿名内部类定义过多，代码简洁，去掉无意义代码，核心逻辑。</p>
<p>理解Functional Interface（函数式接口）是学习Java8 lambda表达式的关键。</p>
<p>函数式接口的定义：任何接口，如果只包含唯一一个抽象方法，那么它就是一个函数式接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对于函数式接口，我们可以通过lambda表达式来创建接口的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">lambda1</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 3.静态内部类</span></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticEntityLike</span> <span class="keyword">implements</span> <span class="title">Like</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lambda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"Static likes lambda!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Like entityLike = <span class="keyword">new</span> EntityLike();</span><br><span class="line">    entityLike.lambda();</span><br><span class="line"></span><br><span class="line">    Like staticEntityLike = <span class="keyword">new</span> StaticEntityLike();</span><br><span class="line">    staticEntityLike.lambda();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.局部内部类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">InternalEntityLike</span> <span class="keyword">implements</span> <span class="title">Like</span> </span>&#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lambda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Internal likes lambda!"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Like internalEntityLike = <span class="keyword">new</span> InternalEntityLike();</span><br><span class="line">    internalEntityLike.lambda();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.匿名内部类，没有类的名称，必须借助接口或者父类</span></span><br><span class="line">    Like anonymousEntityLike = <span class="keyword">new</span> Like() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lambda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Anonymous likes lambda!"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    anonymousEntityLike.lambda();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.用lambda简化</span></span><br><span class="line">    Like lambdaLike = () -&gt; &#123;</span><br><span class="line">      System.out.println(<span class="string">"Lambda likes lambda!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    lambdaLike.lambda();</span><br><span class="line"></span><br><span class="line"><span class="comment">//    new Like(()-&gt;System.out.println("Lambda likes lambda!")).lambda();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.带参数的</span></span><br><span class="line">    Love lambdaLove = (<span class="keyword">int</span> t) -&gt; &#123;</span><br><span class="line">      System.out.println(<span class="string">"Lambda loves you "</span> + t + <span class="string">" times!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    lambdaLove.time(<span class="number">520</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.1简化去掉参数类型</span></span><br><span class="line">    Love love1 = (t) -&gt; &#123;</span><br><span class="line">      System.out.println(<span class="string">"Lambda loves you "</span> + t + <span class="string">" times!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    love1.time(<span class="number">521</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.2简化去掉括号</span></span><br><span class="line">    Love love2 = t -&gt; &#123;</span><br><span class="line">      System.out.println(<span class="string">"Lambda loves you "</span> + t + <span class="string">" times!"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    love2.time(<span class="number">522</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7.3简化去掉花括号</span></span><br><span class="line">    <span class="comment">// lambda表达式只能有一行代码的情况下才能简化成为一行，如果有多行，那么就用代码块包裹</span></span><br><span class="line">    Love love3 = t -&gt; System.out.println(<span class="string">"Lambda loves you "</span> + t + <span class="string">" times!"</span>);</span><br><span class="line">    love3.time(<span class="number">523</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.定义一个函数式接口</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Like</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">lambda</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.实现类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EntityLike</span> <span class="keyword">implements</span> <span class="title">Like</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lambda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"I like lambda!"</span>);</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 带参数的</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Love</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">time</span><span class="params">(<span class="keyword">int</span> t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多个参数可以去掉参数类型，再简化就必须加上括号<code>(a, b)-&gt;{};</code></p>
<h2 id="7、线程"><a href="#7、线程" class="headerlink" title="7、线程"></a>7、线程</h2><h3 id="7-1-线程状态"><a href="#7-1-线程状态" class="headerlink" title="7.1 线程状态"></a>7.1 线程状态</h3><p><img src="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/thread_state.PNG" style="zoom:80%;" /></p>
<p>创建状态（new）：<code>Thread t = new Thread();</code>，线程对象一旦创建，就进入到了新生状态。</p>
<p>就绪状态：当调用<code>start()</code>方法，线程立即进入就绪状态，但不意味着立即调度执行。</p>
<p>运行状态：CPU调度进入运行状态线程才真正执行线程体的代码块。</p>
<p>阻塞状态：当调用<code>sleep()</code>，<code>wait()</code>或同步锁定时，线程进入阻塞状态就是代码不往下执行，阻塞<br>事件解除后，重新进入就绪状态，等待cpu调度执行。</p>
<p>死亡状态（dead）：线程中断或者结束，<strong>一旦进入死亡状态，就不能再次启动</strong>。</p>
<h3 id="7-2-线程方法"><a href="#7-2-线程方法" class="headerlink" title="7.2 线程方法"></a>7.2 线程方法</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">方法</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">setPriority(int newPriority)</td>
<td style="text-align:left">设置当前线程的优先级</td>
</tr>
<tr>
<td style="text-align:center">static void sleep(long millis)</td>
<td style="text-align:left">在指定的毫秒数内让当前正在执行的线程休眠（暂停执行）。休眠的线程进入阻塞状态。</td>
</tr>
<tr>
<td style="text-align:center">void join()</td>
<td style="text-align:left">调用join方法的线程强制执行，其他线程处于阻塞状态，等该线程执行完后，其他线程再执行。有可能被外界中断产生InterruptedException中断异常。</td>
</tr>
<tr>
<td style="text-align:center">static void yield()</td>
<td style="text-align:left">调用yield方法的线程，（暂停当前执行的线程对象）会礼让其他线程先运行。（大概率其他线程先运行，小概率自己还会运行）</td>
</tr>
<tr>
<td style="text-align:center">void interrupt()</td>
<td style="text-align:left">中断线程，不建议使用</td>
</tr>
<tr>
<td style="text-align:center">boolean isAlive()</td>
<td style="text-align:left">判断线程是否处于活动状态 （线程调用start后，即处于活动状态）</td>
</tr>
</tbody>
</table>
</div>
<h3 id="7-3-停止线程"><a href="#7-3-停止线程" class="headerlink" title="7.3 停止线程"></a>7.3 停止线程</h3><ul>
<li><p>不推荐使用JDK提供的<code>stop()</code>和<code>destroy()</code>方法。（已废弃）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SecurityManager security = System.getSecurityManager();</span><br><span class="line">    <span class="keyword">if</span> (security != <span class="keyword">null</span>) &#123;</span><br><span class="line">      checkAccess();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span> != Thread.currentThread()) &#123;</span><br><span class="line">        security.checkPermission(SecurityConstants.STOP_THREAD_PERMISSION);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// A zero status value corresponds to "NEW", it can't change to</span></span><br><span class="line">    <span class="comment">// not-NEW because we hold the lock.</span></span><br><span class="line">    <span class="keyword">if</span> (threadStatus != <span class="number">0</span>) &#123;</span><br><span class="line">      resume(); <span class="comment">// Wake up thread if it was suspended; no-op otherwise</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The VM can handle all thread states</span></span><br><span class="line">    stop0(<span class="keyword">new</span> ThreadDeath());</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError();</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>推荐线程自己停止下来，建议使用一个标志位进行终止变量当<code>flag=false</code>，则终止线程运行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestStop</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 1.设置一个标志位</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">      System.out.println(<span class="string">"run...Thread..."</span>+i++);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 2.设置一个公开的方法停止线程，转换标志位</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.flag = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    TestStop testStop = <span class="keyword">new</span> TestStop();</span><br><span class="line">    <span class="keyword">new</span> Thread(testStop).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">      System.out.println(<span class="string">"main...Thread..."</span>+i);</span><br><span class="line">      <span class="keyword">if</span>(i==<span class="number">100</span>) &#123;</span><br><span class="line">        <span class="comment">// 调用stop方法停止线程</span></span><br><span class="line">        testStop.stop();</span><br><span class="line">        System.out.println(<span class="string">"run...Thread...stoped..."</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：线程停止，main线程继续执行到结束</p>
<p><img src="https://gitee.com/mysteryguest/ObjectStorage/raw/master/Java/Thread/test_stop.PNG" style="zoom:67%;" /></p>
</li>
</ul>
<h3 id="7-4-线程休眠"><a href="#7-4-线程休眠" class="headerlink" title="7.4 线程休眠"></a>7.4 线程休眠</h3><blockquote>
<p>sleep(时间)指定当前线程阻塞的毫秒数；sleep存在异常Interrupted Exception；sleep时间达到后线程进入<strong>就绪状态</strong>；sleep可以模拟网络延时，倒计时等；每一个对象都有一个锁，sleep不会释放锁。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟倒计时</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSleep2</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      tenDown();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印当前系统时间</span></span><br><span class="line">    Date startTime = <span class="keyword">new</span> Date(System.currentTimeMillis());	<span class="comment">// 获取当前系统时间</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"Start printing system time..."</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> SimpleDateFormat(<span class="string">"HH:mm:ss"</span>).format(startTime));</span><br><span class="line">        startTime = <span class="keyword">new</span> Date(System.currentTimeMillis());	<span class="comment">// 更新时间</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tenDown</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">      System.out.println(num--);</span><br><span class="line">      <span class="keyword">if</span> (num&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-4-线程礼让"><a href="#7-4-线程礼让" class="headerlink" title="7.4 线程礼让"></a>7.4 线程礼让</h3><p><strong>礼让线程，让当前正在执行的线程暂停，但不阻塞；将线程从运行状态转为就绪状态；让cpu重新调度，礼让不一定成功！看CPU心情。</strong></p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestYield</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    MyYield myYield = <span class="keyword">new</span> MyYield();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> Thread(myYield, <span class="string">"a"</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(myYield, <span class="string">"b"</span>).start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyYield</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName()+<span class="string">"Thread starts..."</span>);</span><br><span class="line">    Thread.yield();    <span class="comment">// 礼让</span></span><br><span class="line">    System.out.println(Thread.currentThread().getName()+<span class="string">"Thread ends..."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-5-线程强制执行"><a href="#7-5-线程强制执行" class="headerlink" title="7.5 线程强制执行"></a>7.5 线程强制执行</h3><blockquote>
<p>join()合并程序，待此线程执行完成后，再执行其他线程，其他线程阻塞。可以想象为插队。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJoin</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      System.out.println(<span class="string">"VIP thread comes..."</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    TestJoin testJoin = <span class="keyword">new</span> TestJoin();</span><br><span class="line">    Thread thisThread = <span class="keyword">new</span> Thread(testJoin);</span><br><span class="line">    thisThread.start();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i==<span class="number">90</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          thisThread.join();	<span class="comment">// 插队</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"main Thread..."</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>取一个运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">main Thread...0</span><br><span class="line">VIP thread comes...0</span><br><span class="line">main Thread...1</span><br><span class="line">VIP thread comes...1</span><br><span class="line">VIP thread comes...2</span><br><span class="line">VIP thread comes...3</span><br><span class="line">VIP thread comes...4</span><br><span class="line">VIP thread comes...5</span><br><span class="line">...</span><br><span class="line">main Thread...87</span><br><span class="line">main Thread...88</span><br><span class="line">main Thread...89</span><br><span class="line">VIP thread comes...19</span><br><span class="line">VIP thread comes...20</span><br><span class="line">VIP thread comes...21</span><br><span class="line">VIP thread comes...22</span><br><span class="line">VIP thread comes...23</span><br><span class="line">VIP thread comes...24</span><br><span class="line">...</span><br><span class="line">VIP thread comes...98</span><br><span class="line">VIP thread comes...99</span><br><span class="line">main Thread...90</span><br><span class="line">main Thread...91</span><br><span class="line">main Thread...92</span><br><span class="line">main Thread...93</span><br></pre></td></tr></table></figure>
<p>在插队之前，2线程并行，当调用join()后，这个线程即成为VIP，只能等VIP线程执行结束，其他线程才能继续执行。</p>
<h3 id="7-6-线程状态"><a href="#7-6-线程状态" class="headerlink" title="7.6 线程状态"></a>7.6 线程状态</h3><p>线程状态State是枚举类型，有5个状态，在中文帮助文档中有声明。</p>
<p>Thread.java源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">enum</span> State &#123;</span><br><span class="line">    NEW,</span><br><span class="line"></span><br><span class="line">    RUNNABLE,</span><br><span class="line"></span><br><span class="line">    BLOCKED,</span><br><span class="line"></span><br><span class="line">    WAITING,</span><br><span class="line"></span><br><span class="line">    TIMED_WAITING,</span><br><span class="line"></span><br><span class="line">    TERMINATED;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> State <span class="title">getState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sun.misc.VM.toThreadState(threadStatus);</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestState</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"\\\\\\"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 观察状态</span></span><br><span class="line">    Thread.State state = thread.getState();</span><br><span class="line">    System.out.println(state);	<span class="comment">// NEW</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 启动</span></span><br><span class="line">    thread.start();</span><br><span class="line">    state = thread.getState();</span><br><span class="line">    System.out.println(state);	<span class="comment">// RUN</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (state != Thread.State.TERMINATED) &#123;	<span class="comment">// 只要线程不终止就一直输出状态</span></span><br><span class="line">      Thread.sleep(<span class="number">100</span>);</span><br><span class="line">      state = thread.getState();	<span class="comment">// 更新状态</span></span><br><span class="line">      System.out.println(state);</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-7-线程优先级"><a href="#7-7-线程优先级" class="headerlink" title="7.7 线程优先级"></a>7.7 线程优先级</h3><blockquote>
<p>Java提供一个线程调度器来监控程序中启动后进入就绪状态的所有线程，线程调度器按照优先级决定应该调度哪个线程来执行；线程的优先级用数字表示，范围从1-10。</p>
</blockquote>
<p>Thread.java源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MIN_PRIORITY = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NORM_PRIORITY = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX_PRIORITY = <span class="number">10</span>;</span><br><span class="line">  ...</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> newPriority)</span> </span>&#123;</span><br><span class="line">    ThreadGroup g;</span><br><span class="line">    checkAccess();</span><br><span class="line">    <span class="keyword">if</span> (newPriority &gt; MAX_PRIORITY || newPriority &lt; MIN_PRIORITY) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((g = getThreadGroup()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (newPriority &gt; g.getMaxPriority()) &#123;</span><br><span class="line">        newPriority = g.getMaxPriority();</span><br><span class="line">      &#125;</span><br><span class="line">      setPriority0(priority = newPriority);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>优先级低只是意味着获得调度的概率低，并不是优先级低就不会被调用了，这都是看CPU的调度。</p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPriority</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 主线程默认优先级</span></span><br><span class="line">    System.out.println(</span><br><span class="line">        Thread.currentThread().getName() +</span><br><span class="line">        <span class="string">"--&gt;"</span>+Thread.currentThread().getPriority()</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    MyPriority myPriority = <span class="keyword">new</span> MyPriority();</span><br><span class="line">    </span><br><span class="line">    Thread t1 = <span class="keyword">new</span> Thread(myPriority);</span><br><span class="line">    Thread t2 = <span class="keyword">new</span> Thread(myPriority);</span><br><span class="line">    Thread t3 = <span class="keyword">new</span> Thread(myPriority);</span><br><span class="line">    Thread t4 = <span class="keyword">new</span> Thread(myPriority);</span><br><span class="line">    Thread t5 = <span class="keyword">new</span> Thread(myPriority);</span><br><span class="line"></span><br><span class="line">    t1.start();</span><br><span class="line">    </span><br><span class="line">    t2.setPriority(<span class="number">2</span>);	<span class="comment">// 先设置优先级再启动</span></span><br><span class="line">    t2.start();</span><br><span class="line">    </span><br><span class="line">    t3.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">    t3.start();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      t4.setPriority(-<span class="number">1</span>);</span><br><span class="line">      t4.start();</span><br><span class="line">      </span><br><span class="line">      t5.setPriority(<span class="number">11</span>);</span><br><span class="line">      t5.start();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      System.err.println(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPriority</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(</span><br><span class="line">        Thread.currentThread().getName()+<span class="string">"--&gt;"</span> +</span><br><span class="line">        Thread.currentThread().getPriority()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>取一个运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main--&gt;5</span><br><span class="line">java.lang.IllegalArgumentException</span><br><span class="line">Thread-0--&gt;5</span><br><span class="line">Thread-2--&gt;10</span><br><span class="line">Thread-1--&gt;2</span><br></pre></td></tr></table></figure>
<p>总是主线程mian限制性，优先级低的也可能比高的优先执行。</p>
<h3 id="7-8-守护（daemon）线程"><a href="#7-8-守护（daemon）线程" class="headerlink" title="7.8 守护（daemon）线程"></a>7.8 守护（daemon）线程</h3><blockquote>
<p>线程分为用户线程和守护线程；虚拟机必须确保用户线程（main线程）执行完毕；虚拟机不用等待守护线程执行完毕；如后台记录操作日志，监控内存垃圾回收等。</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDaemon</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    God god = <span class="keyword">new</span> God();</span><br><span class="line">    Man man = <span class="keyword">new</span> Man();</span><br><span class="line">    </span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(god);</span><br><span class="line">    thread.setDaemon(<span class="keyword">true</span>);  <span class="comment">// 默认false表示用户线程，正常的线程都是用户线程</span></span><br><span class="line">    </span><br><span class="line">    thread.start();  <span class="comment">// 守护线程启动</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> Thread(man).start();  <span class="comment">// 用户线程挺停止</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">God</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">      System.out.println(<span class="string">"God bless you!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    System.err.println(<span class="string">"Goodbye World!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看似god线程会一直循环执行下去，但它是守护线程，man线程执行结束后，守护线程等一会也会结束，因为虚拟机还会运行一会儿。</p>
<h2 id="8、线程同步"><a href="#8、线程同步" class="headerlink" title="8、线程同步"></a>8、线程同步</h2><p>多个线程操作同一个资源。</p>
<p>并发：同一个对象被多个线程同时操作。</p>
<p>处理多线程问题时，多个线程访问同—个对象，并且某些线程还想修改这个对象，这时候我们就需要线程同步。线程同步其实就是一种等待机制，多个需要同时访问此对象的线程进入这个对象的等待池形成队列，等待前面线程使用完毕，下一个线程再使用。</p>
<h3 id="8-1-队列和锁"><a href="#8-1-队列和锁" class="headerlink" title="8.1 队列和锁"></a>8.1 队列和锁</h3><p>由于同一进程的多个线程共享同一块存储空间，在带来方便的同时，也带来了访问冲突问题，为了保证数据在方法中被访问时的正确性，在访问时加入锁机制synchronized，当一个线程获得对象的排它锁（锁是对象的），将会独占资源。其他线程必须等待这个线程使用后释放锁即可。存在以下问题：</p>
<ul>
<li><p>一个线程持有锁会导致其他所有需要此锁的<strong>线程挂起</strong></p>
</li>
<li><p>在多线程竞争下，加锁，释放锁会导致比较多的<strong>上下文切换</strong>和<strong>调度延时</strong>，引起性能问题</p>
</li>
<li><p>如果一个优先级高的线程等待一个优先级低的线程释放锁会导致<strong>优先级倒置</strong>，引起性能问题</p>
</li>
</ul>
<h3 id="8-2-同步方法"><a href="#8-2-同步方法" class="headerlink" title="8.2 同步方法"></a>8.2 同步方法</h3><ul>
<li><p>由于我们可以通过private关键字来保证数据对象只能被方法访问，所以我们只需要针对方法提出一套机制，这套机制就是synchronized关键字，它包括两种用法synchronized方法和synchronized块</p>
<blockquote>
<p>同步方法: <code>public synchronized void method(int args)</code></p>
</blockquote>
</li>
<li><p>synchronized方法控制对“<strong>对象</strong>“的访问，每个<strong>对象</strong>对应一把锁，每个synchronized方法都必须获得调用该方法的对象的锁才能执行，否则线程会阻塞，方法一旦执行，就独占该锁，直到该方法返回才释放锁，后面被阻塞的线程才能获得这个锁，继续执行</p>
<blockquote>
<p>缺陷：若将一个大的方法申明为 synchronized将会影响效率</p>
</blockquote>
</li>
<li><p>弊端：需要锁太多，浪费资源</p>
</li>
</ul>
<h3 id="8-3-同步块"><a href="#8-3-同步块" class="headerlink" title="8.3 同步块"></a>8.3 同步块</h3><ul>
<li><p>同步块：<code>synchronized(obj){}</code></p>
</li>
<li><p>obj称之为同步监视器</p>
<ul>
<li>obj可以是任何对象，但是推荐使用共享资源作为同步监视器</li>
<li>同步方法中无需指定同步监视器，因为同步方法的同步监视器就是this，就是这个对象本身，或者是class[反射中讲解]</li>
</ul>
</li>
<li><p>同步监视器的执行过程</p>
<ul>
<li>第一个线程访问，锁定同步监视器，执行其中代码</li>
<li>第二个线程访问，发现同步监视器被锁定，无法访问</li>
<li>第一个线程访问完毕，解锁同步监视器</li>
<li>第二个线程访问，发现同步监视器没有锁，然后锁定并访问</li>
</ul>
</li>
</ul>
<p>案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bank</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Account account = <span class="keyword">new</span> Account(<span class="number">100</span>, <span class="string">"Deposit"</span>);</span><br><span class="line">    </span><br><span class="line">    Drawing husband = <span class="keyword">new</span> Drawing(account, <span class="number">50</span>, <span class="string">"husband"</span>);</span><br><span class="line">    Drawing wife = <span class="keyword">new</span> Drawing(account, <span class="number">100</span>, <span class="string">"wife"</span>);</span><br><span class="line">    </span><br><span class="line">    husband.start();</span><br><span class="line">    wife.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> money;</span><br><span class="line">  String name;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">int</span> money, String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.money = money;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Drawing</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  Account account;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> drawingMoney;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> nowMoney;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Drawing</span><span class="params">(Account account, <span class="keyword">int</span> drawingMoney, String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(name);</span><br><span class="line">    <span class="keyword">this</span>.account = account;</span><br><span class="line">    <span class="keyword">this</span>.drawingMoney = drawingMoney;</span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  <span class="comment">// @Override</span></span><br><span class="line">  <span class="comment">// public synchronized void run() &#123;</span></span><br><span class="line">  <span class="comment">//   if(account.money-drawingMoney&lt;0) &#123;</span></span><br><span class="line">  <span class="comment">//     System.out.println(Thread.currentThread().getName()+" Money is not enough!");</span></span><br><span class="line">  <span class="comment">//     return;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//   try &#123;</span></span><br><span class="line">  <span class="comment">//     Thread.sleep(1000);</span></span><br><span class="line">  <span class="comment">//   &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line">  <span class="comment">//     e.printStackTrace();</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   // 卡内余额</span></span><br><span class="line">  <span class="comment">//   account.money = account.money - drawingMoney;</span></span><br><span class="line">  <span class="comment">//   // 手里的现金</span></span><br><span class="line">  <span class="comment">//   nowMoney = nowMoney + drawingMoney;</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">//   System.out.println(account.name + " balance is "+account.money);</span></span><br><span class="line">  <span class="comment">//   System.out.println(this.getName()+"'s cash now is "+nowMoney);</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (account) &#123;</span><br><span class="line">      <span class="keyword">if</span>(account.money-drawingMoney&lt;<span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName()+<span class="string">" Money is not enough!"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      account.money = account.money - drawingMoney;</span><br><span class="line"></span><br><span class="line">      nowMoney = nowMoney + drawingMoney;</span><br><span class="line">      </span><br><span class="line">      System.out.println(account.name + <span class="string">" balance is "</span>+account.money);</span><br><span class="line">      System.out.println(<span class="keyword">this</span>.getName()+<span class="string">"'s cash now is "</span>+nowMoney);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里要注意了：同步块指定锁住的对象，可以锁住任何对象。如果用上面的方法将run方法上锁，锁住的是husband和wife对象，也就是有两把锁了（2个线程2把锁）。只能用下面的方法锁住变化的量，才有用。</p>
<p>List等常见数据集合是非安全的，JUC(java.util.concurrent包)中提供了CopyOnWriteArrayList等安全类型的集合。</p>
</blockquote>
<h2 id="9、锁"><a href="#9、锁" class="headerlink" title="9、锁"></a>9、锁</h2><h3 id="9-1-死锁"><a href="#9-1-死锁" class="headerlink" title="9.1 死锁"></a>9.1 死锁</h3><blockquote>
<p>多个线程各自占有一些共享资源，并且互相等待其他线程占有的资源才能运行，而导致两个或者多个线程都在等待对方释放资源，都停止执行的情形。某一个同步块同时拥有“两个以上对象的锁”时，就可能会发生“死锁”的问题。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadLock</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Makeup girl1 = <span class="keyword">new</span> Makeup(<span class="number">0</span>, <span class="string">"Marry"</span>);</span><br><span class="line">    Makeup girl2 = <span class="keyword">new</span> Makeup(<span class="number">1</span>, <span class="string">"Lisa"</span>);</span><br><span class="line">    </span><br><span class="line">    girl1.start();</span><br><span class="line">    girl2.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lipstick</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mirror</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Makeup</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用static保证资源只有一份儿</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Lipstick lipstick = <span class="keyword">new</span> Lipstick();</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Mirror mirror = <span class="keyword">new</span> Mirror();</span><br><span class="line">  <span class="keyword">int</span> choice;</span><br><span class="line">  String name;	<span class="comment">// 化妆的人</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Makeup</span><span class="params">(<span class="keyword">int</span> choice, String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.choice = choice;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      startMakeup();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 化妆，互相持有对方的锁，就是需要拿到对方的资源</span></span><br><span class="line">  <span class="comment">// private void startMakeup() throws InterruptedException &#123;</span></span><br><span class="line">  <span class="comment">//   if (choice==0) &#123;</span></span><br><span class="line">  <span class="comment">//     synchronized (lipstick) &#123;	// 获得口红的锁</span></span><br><span class="line">  <span class="comment">//       System.out.println(this.name+" got the lipstick!");</span></span><br><span class="line">  <span class="comment">//       Thread.sleep(1000);</span></span><br><span class="line">  <span class="comment">//       synchronized (mirror) &#123;	// 1秒钟后向获得镜子</span></span><br><span class="line">  <span class="comment">//         System.out.println(this.name+" got the mirror!");</span></span><br><span class="line">  <span class="comment">//       &#125;</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">//   &#125; else &#123;</span></span><br><span class="line">  <span class="comment">//     synchronized (mirror) &#123;</span></span><br><span class="line">  <span class="comment">//       System.out.println(this.name+" got the mirror!");</span></span><br><span class="line">  <span class="comment">//       Thread.sleep(1000);</span></span><br><span class="line">  <span class="comment">//       synchronized (lipstick) &#123;</span></span><br><span class="line">  <span class="comment">//         System.out.println(this.name+" got the lipstick!");</span></span><br><span class="line">  <span class="comment">//       &#125;</span></span><br><span class="line">  <span class="comment">//     &#125;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   // 比如选择0时，只有当得到镜子后才会释放口红的锁，就会死锁</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMakeup</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (choice==<span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (lipstick) &#123;	<span class="comment">// 获得口红的锁</span></span><br><span class="line">        System.out.println(<span class="keyword">this</span>.name+<span class="string">" got the lipstick!"</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">synchronized</span> (mirror) &#123;	<span class="comment">// 1秒钟后向获得镜子</span></span><br><span class="line">        System.out.println(<span class="keyword">this</span>.name+<span class="string">" got the mirror!"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (mirror) &#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.name+<span class="string">" got the mirror!"</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">synchronized</span> (lipstick) &#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.name+<span class="string">" got the lipstick!"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 这样做就是当口红用完口红的锁就释放</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结合操作系统死锁产生的条件和避免死锁的方式。</p>
<h3 id="9-2-Lock（锁）"><a href="#9-2-Lock（锁）" class="headerlink" title="9.2 Lock（锁）"></a>9.2 Lock（锁）</h3><ul>
<li><p>从JDK5.0开始，Java提供了更强大的线程同步机制：通过显式定义<strong>同步锁对象</strong>来实现同步。同步锁使用Lock对象充当</p>
</li>
<li><p>java.utll.concurrent.locks.Lock接口是控制多个线程对共享资源进行访问的工具。锁提供了对共享资源的独占访问,毎次只能有一个线程对Lock对象加锁，线程开始访问共享资源之前应先获得Lock对象</p>
</li>
<li><p>ReentrantLock（可重入锁）类实现了Lock，它拥有与synchronized相同的并发性和内存语义，在实现线程安全的控制中，比较常用的是Reentrantlock，可以显式加锁、释放锁。</p>
</li>
</ul>
<h3 id="9-3-synchronized和Lock的对比"><a href="#9-3-synchronized和Lock的对比" class="headerlink" title="9.3 synchronized和Lock的对比"></a>9.3 synchronized和Lock的对比</h3><ul>
<li><p>Lock是显式锁（手动开启和关闭锁，别忘记关闭锁）synchronized是隐式锁，出了作用域自动释放</p>
</li>
<li><p>Lock只有代码块锁，synchronized有代码块锁和方法锁</p>
</li>
<li><p>使用Lock锁，JwM将花费较少的时间来调度线程，性能更好。并且具有更好的扩展性（提供更多的子类）</p>
</li>
<li><p>优先使用顺序：Lock &gt; 同步代码块（已经进入了方法体，分配了相应资源） &gt; 同步方法（在方法体之外）</p>
</li>
</ul>
<h2 id="10、线程协作（线程通信）"><a href="#10、线程协作（线程通信）" class="headerlink" title="10、线程协作（线程通信）"></a>10、线程协作（线程通信）</h2><blockquote>
<p>在生产者消费者问题中，仅有synchronized是不够的</p>
<ul>
<li><p>synchronized可阻止并发更新同一个共享资源，实现了同步</p>
</li>
<li><p>synchronized不能用来实现不同线程之间的消息传递（通信）</p>
</li>
</ul>
</blockquote>
<p>Java提供了几个方法解决线程之间的通信问题</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>wait()</td>
<td>表示线程一直等待，直到其他线程通知，与sleep不同，会释放锁</td>
</tr>
<tr>
<td>wait(long timeout)</td>
<td>指定等待的毫秒数</td>
</tr>
<tr>
<td>notify()</td>
<td>唤醒一个处于等待状态的线程</td>
</tr>
<tr>
<td>notifyAll()</td>
<td>唤醒同一个对象上所有调用wait()方法的线程，优先级别高的线程优先调度</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>注意：均是Object类的方法，都只能在同步方法或者同步代码块中使用否则会抛出异常IlegalMonitorState Exception</p>
</blockquote>
<h3 id="10-1-解决方式1：管程法"><a href="#10-1-解决方式1：管程法" class="headerlink" title="10.1 解决方式1：管程法"></a>10.1 解决方式1：管程法</h3><p>并发协作模型“生产者/消费者模式”—&gt;管程法</p>
<ul>
<li><p>生产者：负责生产数据的模块(可能是方法，对象，线程，进程)</p>
</li>
<li><p>消费者：负责处理数据的模块(可能是方法，对象，线程，进程)</p>
</li>
<li><p>缓冲区：消费者不能直接使用生产者的数据，他们之间有个“缓冲区“</p>
</li>
</ul>
<p>生产者将生产好的数据放入<strong>缓冲区</strong>，消费者从缓冲区拿出数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestProductorCustomer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Buffer buffer = <span class="keyword">new</span> Buffer();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> Productor(buffer).start();</span><br><span class="line">    <span class="keyword">new</span> Customer(buffer).start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Productor</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 需要一个容器</span></span><br><span class="line">  Buffer buffer;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Productor</span><span class="params">(Buffer buffer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.buffer = buffer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生产</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      buffer.push(<span class="keyword">new</span> Goods(i));</span><br><span class="line">      System.out.println(<span class="string">"生产了第"</span>+i+<span class="string">"个商品！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  Buffer buffer;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(Buffer buffer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.buffer = buffer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 消费</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      System.out.println(<span class="string">"消费了第"</span> + buffer.pop().getID() + <span class="string">"个商品！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 产品</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goods</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> ID;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Goods</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.ID = id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ID;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓冲区</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buffer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 需要一个容器大小</span></span><br><span class="line">  Goods[] goods = <span class="keyword">new</span> Goods[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 生产者放入产品</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Goods good)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果容器满了，就需要等待消费者消费</span></span><br><span class="line">    <span class="keyword">if</span>(count==goods.length) &#123;</span><br><span class="line">      <span class="comment">// 通知消费者消费，生产等待</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果没有满就需要放入产品</span></span><br><span class="line">    goods[count] = good;</span><br><span class="line">    count++;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可以通知消费者消费了</span></span><br><span class="line">    <span class="keyword">this</span>.notifyAll();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 消费者消费产品</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Goods <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果容器是否为空</span></span><br><span class="line">    <span class="keyword">if</span>(count==<span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 通知生产者生产，消费等待</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果可以消费</span></span><br><span class="line">    count--;</span><br><span class="line">    Goods good = goods[count];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以通知生产者生产了</span></span><br><span class="line">    <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    <span class="keyword">return</span> good;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-2-解决方式2：信号灯法"><a href="#10-2-解决方式2：信号灯法" class="headerlink" title="10.2 解决方式2：信号灯法"></a>10.2 解决方式2：信号灯法</h3><p>就是长度为1的管程法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductorCustomerUsingSignal</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Show show = <span class="keyword">new</span> Show();</span><br><span class="line">    <span class="keyword">new</span> Actor(show).start();</span><br><span class="line">    <span class="keyword">new</span> Audience(show).start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产者演员</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Actor</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Show show;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Actor</span><span class="params">(Show show)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.show = show;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.show.play(<span class="string">"Happy Camp!"</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.show.play(<span class="string">"TikTok!"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者观众</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Audience</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Show show;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Audience</span><span class="params">(Show show)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.show = show;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">this</span>.show.watch();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 资源节目</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 演员表演，观众等待	T</span></span><br><span class="line">  <span class="comment">// 观众观看，演员等待	F</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">  String display;	<span class="comment">// 表演的节目</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表演</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String display)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"Actors show the "</span>+display);</span><br><span class="line">    <span class="comment">// 通知观众观看</span></span><br><span class="line">    <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    <span class="keyword">this</span>.display = display;</span><br><span class="line">    <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 表演</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">watch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.wait();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">"Audience watch the "</span>+display);</span><br><span class="line">    <span class="comment">// 通知演员表演</span></span><br><span class="line">    <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="11、线程池"><a href="#11、线程池" class="headerlink" title="11、线程池"></a>11、线程池</h2><blockquote>
<p>背景：经常创建和销毁、使用量特别大的资源，比如并发情况下的线程，对性能影响很大。</p>
<p>思路：提前创建好多个线程，放入线程池中，使用时直接获取，使用完放回池中。可以避免频繁创建销毁、实现重复利用。类似生活中的公共交通工具（共享单车）。</p>
</blockquote>
<p>优势：</p>
<ul>
<li><p>提高响应速度（减少了创建新线程的时间）</p>
</li>
<li><p>降低资源消耗（重复利用线程池中线程，不需要每次都创建）</p>
</li>
<li><p>便于线程管理（…）</p>
<ul>
<li>core Poolsize：核心池的大小</li>
<li>maximumPoolsize：最大线程数</li>
<li>keepAlive Time：线程没有任务时最多保持多长时间后会终止</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPool</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.创建服务，创建线程池</span></span><br><span class="line">    ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    executorService.execute(<span class="keyword">new</span> PoolThread());</span><br><span class="line">    executorService.execute(<span class="keyword">new</span> PoolThread());</span><br><span class="line">    executorService.execute(<span class="keyword">new</span> PoolThread());</span><br><span class="line">    executorService.execute(<span class="keyword">new</span> PoolThread());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.关闭连接</span></span><br><span class="line">    executorService.shutdown();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PoolThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>JDK5.0起提供了线程池相关API：Executor Service和Executors</p>
</li>
<li><p>Executor Service：真正的线程池接口。常见子类 ThreadPoolExecutor</p>
<ul>
<li><code>void execute( Runnable command)</code>：执行任务命令，没有返回值，一般用来执<br>行 Runnable</li>
<li><code>&lt;T&gt; Future&lt;T&gt; submit( Callable&lt;T&gt;task)</code>：执行任务，有返回值，一般又来执行<br>Callable（上面我们介绍Callable接口时测试过）</li>
<li><code>void shutdown()</code>：关闭连接池</li>
</ul>
</li>
<li><p>Executors：工具类、线程池的工厂类，用于创建并返回不同类型的线程池</p>
</li>
</ul>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Java/">Java</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button is-info donate"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/donate/alipay.jpg" alt="支付宝"></span></a><a class="button is-success donate"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/donate/wechatpay.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/09/13/Github/Profile/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">管理GitHub个人资料README</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/09/04/ComputerNetwork/postgraduate/"><span class="level-item">计算机网络课程复习</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "vucxC0bltE95lsPGxGXlUJBf-gzGzoHsz",
            appKey: "YgRn5inwLxs6B4VgyLp4zvti",
            placeholder: "ヾﾉ≧∀≦)o快来评论一下吧!",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/shadow.jpg" alt="肖梦杰"></figure><p class="title is-size-4 is-block line-height-inherit">肖梦杰</p><p class="is-size-6 is-block">MysticalGuest</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Xiangyang City, Hubei Province, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">45</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">11</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">14</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/MysticalGuest" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/MysticalGuest"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="QQ" href="https://user.qzone.qq.com/1317148109/main"><i class="fab fa-qq"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/MysticalGuest"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:etherealsymbol@gmail.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="is-flex" href="#1、前言"><span class="mr-2">1</span><span>1、前言</span></a></li><li><a class="is-flex" href="#2、Thread类"><span class="mr-2">2</span><span>2、Thread类</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-1-Thread类实现Runnable接口"><span class="mr-2">2.1</span><span>2.1 Thread类实现Runnable接口</span></a></li><li><a class="is-flex" href="#2-2-创建步骤："><span class="mr-2">2.2</span><span>2.2 创建步骤：</span></a><ul class="menu-list"><li><a class="is-flex" href="#2-2-1-测试"><span class="mr-2">2.2.1</span><span>2.2.1 测试</span></a></li><li><a class="is-flex" href="#2-2-2-案例：实现多线程同步下载图片"><span class="mr-2">2.2.2</span><span>2.2.2 案例：实现多线程同步下载图片</span></a></li></ul></li></ul></li><li><a class="is-flex" href="#3、Runnable接口"><span class="mr-2">3</span><span>3、Runnable接口</span></a><ul class="menu-list"><li><a class="is-flex" href="#3-1-Runnable接口"><span class="mr-2">3.1</span><span>3.1 Runnable接口</span></a></li><li><a class="is-flex" href="#3-2-创建步骤"><span class="mr-2">3.2</span><span>3.2 创建步骤</span></a></li><li><a class="is-flex" href="#3-3-对比"><span class="mr-2">3.3</span><span>3.3 对比</span></a></li></ul></li><li><a class="is-flex" href="#4、Callable接口（了解即可）"><span class="mr-2">4</span><span>4、Callable接口（了解即可）</span></a><ul class="menu-list"><li><a class="is-flex" href="#4-1-源码："><span class="mr-2">4.1</span><span>4.1 源码：</span></a></li><li><a class="is-flex" href="#4-2-创建步骤"><span class="mr-2">4.2</span><span>4.2 创建步骤</span></a></li></ul></li><li><a class="is-flex" href="#5、静态代理模式"><span class="mr-2">5</span><span>5、静态代理模式</span></a><ul class="menu-list"><li><a class="is-flex" href="#5-1-内容"><span class="mr-2">5.1</span><span>5.1 内容</span></a></li><li><a class="is-flex" href="#5-2-设计"><span class="mr-2">5.2</span><span>5.2 设计</span></a></li></ul></li><li><a class="is-flex" href="#6、Lambda表达式"><span class="mr-2">6</span><span>6、Lambda表达式</span></a><ul class="menu-list"><li><a class="is-flex" href="#6-1-为什么要使用lambda表达式？"><span class="mr-2">6.1</span><span>6.1 为什么要使用lambda表达式？</span></a></li></ul></li><li><a class="is-flex" href="#7、线程"><span class="mr-2">7</span><span>7、线程</span></a><ul class="menu-list"><li><a class="is-flex" href="#7-1-线程状态"><span class="mr-2">7.1</span><span>7.1 线程状态</span></a></li><li><a class="is-flex" href="#7-2-线程方法"><span class="mr-2">7.2</span><span>7.2 线程方法</span></a></li><li><a class="is-flex" href="#7-3-停止线程"><span class="mr-2">7.3</span><span>7.3 停止线程</span></a></li><li><a class="is-flex" href="#7-4-线程休眠"><span class="mr-2">7.4</span><span>7.4 线程休眠</span></a></li><li><a class="is-flex" href="#7-4-线程礼让"><span class="mr-2">7.5</span><span>7.4 线程礼让</span></a></li><li><a class="is-flex" href="#7-5-线程强制执行"><span class="mr-2">7.6</span><span>7.5 线程强制执行</span></a></li><li><a class="is-flex" href="#7-6-线程状态"><span class="mr-2">7.7</span><span>7.6 线程状态</span></a></li><li><a class="is-flex" href="#7-7-线程优先级"><span class="mr-2">7.8</span><span>7.7 线程优先级</span></a></li><li><a class="is-flex" href="#7-8-守护（daemon）线程"><span class="mr-2">7.9</span><span>7.8 守护（daemon）线程</span></a></li></ul></li><li><a class="is-flex" href="#8、线程同步"><span class="mr-2">8</span><span>8、线程同步</span></a><ul class="menu-list"><li><a class="is-flex" href="#8-1-队列和锁"><span class="mr-2">8.1</span><span>8.1 队列和锁</span></a></li><li><a class="is-flex" href="#8-2-同步方法"><span class="mr-2">8.2</span><span>8.2 同步方法</span></a></li><li><a class="is-flex" href="#8-3-同步块"><span class="mr-2">8.3</span><span>8.3 同步块</span></a></li></ul></li><li><a class="is-flex" href="#9、锁"><span class="mr-2">9</span><span>9、锁</span></a><ul class="menu-list"><li><a class="is-flex" href="#9-1-死锁"><span class="mr-2">9.1</span><span>9.1 死锁</span></a></li><li><a class="is-flex" href="#9-2-Lock（锁）"><span class="mr-2">9.2</span><span>9.2 Lock（锁）</span></a></li><li><a class="is-flex" href="#9-3-synchronized和Lock的对比"><span class="mr-2">9.3</span><span>9.3 synchronized和Lock的对比</span></a></li></ul></li><li><a class="is-flex" href="#10、线程协作（线程通信）"><span class="mr-2">10</span><span>10、线程协作（线程通信）</span></a><ul class="menu-list"><li><a class="is-flex" href="#10-1-解决方式1：管程法"><span class="mr-2">10.1</span><span>10.1 解决方式1：管程法</span></a></li><li><a class="is-flex" href="#10-2-解决方式2：信号灯法"><span class="mr-2">10.2</span><span>10.2 解决方式2：信号灯法</span></a></li></ul></li><li><a class="is-flex" href="#11、线程池"><span class="mr-2">11</span><span>11、线程池</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://spring.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Spring</span></span><span class="level-right"><span class="level-item tag">spring.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://redis.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Redis</span></span><span class="level-right"><span class="level-item tag">redis.io</span></span></a></li><li><a class="level is-mobile is-mobile" href="https://docker.com" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Docker</span></span><span class="level-right"><span class="level-item tag">docker.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/%E4%B8%BB%E9%A2%98/"><span class="level-start"><span class="level-item">主题</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">原理</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E/"><span class="level-start"><span class="level-item">搜索引擎</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="level-start"><span class="level-item">数据库</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%A1%86%E6%9E%B6/"><span class="level-start"><span class="level-item">框架</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%A7%AF%E7%B4%AF/"><span class="level-start"><span class="level-item">积累</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">算法</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><span class="level-start"><span class="level-item">计算机网络</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AF%BE%E7%A8%8B/"><span class="level-start"><span class="level-item">课程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E9%85%8D%E7%BD%AE/"><span class="level-start"><span class="level-item">配置</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Axios/"><span class="tag">Axios</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C#</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ElasticSearch/"><span class="tag">ElasticSearch</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Electron-Vue/"><span class="tag">Electron-Vue</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Element-UI/"><span class="tag">Element-UI</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GitHub/"><span class="tag">GitHub</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag is-grey-lightest">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OS/"><span class="tag">OS</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spring/"><span class="tag">Spring</span><span class="tag is-grey-lightest">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Theory/"><span class="tag">Theory</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TypeScript/"><span class="tag">TypeScript</span><span class="tag is-grey-lightest">1</span></a></div></div></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/mylogo.svg" alt="Longing(MysteryGuest的博客)" height="28"></a><p class="size-small"><span>&copy; 2020 MysticalGuest</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span><br><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv">0</span>次</span><br><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><span><script>	var now = new Date();	function createtime() {		var grt= new Date("4/2/2020 08:00:00");		now.setTime(now.getTime()+250);		days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 		hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 		if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 		mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 		seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 		snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 		document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 		document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";	}	setInterval("createtime()",250);</script></span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/MysticalGuest"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://mysticalguest.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="/js/click.js"></script><script src="/js/anime.min.js"></script><canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas><script src="/js/snow.js"></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>